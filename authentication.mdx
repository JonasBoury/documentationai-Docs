---
title: Authentication
description: Secure authentication methods for accessing Citizen Pay APIs
---

## Overview

You authenticate with Citizen Pay using API keys generated from your dashboard. This process ensures all requests are authorized and secure. API keys support both sandbox and production environments, allowing safe testing before deployment.

<Callout kind="tip">
  Rotate your API keys regularly to maintain security. Store them in environment variables, not in code.
</Callout>

<Columns cols={2}>
  <Card title="API Key Generation" icon="key" href="#">
    Create and manage keys via the dashboard.
  </Card>
  <Card title="Token-Based Auth" icon="shield" href="#">
    Use Bearer tokens for enhanced security in sensitive operations.
  </Card>
</Columns>

## Generating API Keys

Access your Citizen Pay dashboard and navigate to the `settings` section. Click `Generate New Key` to create a key pair. Each key includes a secret that you copy immediately, as it won't be shown again.

<Tabs>
  <Tab title="Dashboard Steps" icon="settings">
    <Steps>
      <Step title="Login" icon="login">
        Enter your credentials on the dashboard.
      </Step>
      <Step title="Navigate to API" icon="api">
        Go to `API Management` under account settings.
      </Step>
      <Step title="Create Key" icon="plus">
        Select scopes like `payments:read` and `payments:write`.
        
````javascript
const scopes = ['payments:read', 'payments:write'];
// Use in dashboard UI to set permissions
````
      </Step>
    </Steps>
  </Tab>
  <Tab title="Key Usage" icon="code">
    Include the key in request headers.
    
````javascript
const response = await fetch('https://api.citizenpay.com/v1/payments', {
  method: 'GET',
  headers: {
    'Authorization': `Bearer ${process.env.CITIZEN_PAY_API_KEY}`,
    'Content-Type': 'application/json'
  }
});
````
  </Tab>
</Tabs>

## Scopes and Permissions

You assign specific scopes to limit key access. For example, a read-only key can't create payments. Common scopes include `payments:read`, `payments:write`, and `webhooks:manage`.

| Scope            | Description                          | Use Case                  |
|------------------|--------------------------------------|---------------------------|
| payments:read    | Retrieve payment details             | Status checks             |
| payments:write   | Create and update payments           | Processing transactions   |
| users:read       | View user accounts                   | Reporting                 |

<ExpandableGroup>
  <Expandable title="How to Revoke a Key?" default-open="false">
    In the dashboard, select the key and click `Revoke`. This immediately disables it. Generate a new one if needed.
  </Expandable>
  <Expandable title="Error Handling for Auth" default-open="false">
    If you receive a `401 Unauthorized`, check your key and scopes. Ensure the environment matches (sandbox vs production).
    
````javascript
try {
  const payments = await client.payments.list();
} catch (error) {
  if (error.status === 401) {
    console.log('Invalid API key. Please regenerate.');
  }
}
````
  </ExpandableGroup>

## Environment Configuration

Set up different keys for testing and live use. Use `.env` files in your project.

<CodeGroup tabs="Node.js,Docker">
  ```javascript
// .env file
CITIZEN_PAY_API_KEY=sk_test_your_sandbox_key
CITIZEN_PAY_ENV=sandbox

// Usage
import dotenv from 'dotenv';
dotenv.config();
const client = new CitizenPay({
  apiKey: process.env.CITIZEN_PAY_API_KEY,
  env: process.env.CITIZEN_PAY_ENV
});
```
  ```docker
# docker-compose.yml
environment:
  - CITIZEN_PAY_API_KEY=sk_live_your_production_key
  - CITIZEN_PAY_ENV=production
```
</CodeGroup>

You switch environments by changing the URL base: `https://api.sandbox.citizenpay.com` for testing. This prevents accidental live charges.

## Security Best Practices

Never commit API keys to version control. Use secret management tools like AWS Secrets Manager for production. Monitor key usage in the dashboard to detect anomalies.

````mermaid
graph TD
    A[Request with Bearer Token] --> B[API Gateway Validation]
    B --> C{Valid Key?}
    C -- Yes --> D[Process Request]
    C -- No --> E[Return 401]
````

This validation flow protects your endpoints. You also enable IP whitelisting for added security.

## Troubleshooting

Common issues include mismatched environments or expired keys. Check the response body for details like `{ "error": "invalid_key" }`. Contact support if problems persist.

<Callout kind="danger">
  Do not share API secrets publicly. Exposure can lead to unauthorized charges.
</Callout>

By following these steps, you secure your Citizen Pay integration effectively. This setup supports scalable applications with minimal risk.